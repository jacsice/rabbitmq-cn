
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Hello World · GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="worker.html" />
    
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    开始
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" >
            
                <span>
            
                    
                    消息队列模式
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter active" data-level="1.2.1" data-path="hello_world.html">
            
                <a href="hello_world.html">
            
                    
                    Hello World
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="worker.html">
            
                <a href="worker.html">
            
                    
                    Work queues
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="publish_subscribe.html">
            
                <a href="publish_subscribe.html">
            
                    
                    Publish / Subscribe 
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4" data-path="routing.html">
            
                <a href="routing.html">
            
                    
                    Routing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.5" data-path="topics.html">
            
                <a href="topics.html">
            
                    
                    Topics
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.6" data-path="rpc.html">
            
                <a href="rpc.html">
            
                    
                    RPC
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.7" data-path="publisher_confirms.md">
            
                <span>
            
                    
                    Publisher Confirms
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" >
            
                <span>
            
                    
                    服务端文档(Server Documentation)
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../server/configuration.md">
            
                <span>
            
                    
                    Configuration
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Hello World</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h4 id="&#x4ECB;&#x7ECD;">&#x4ECB;&#x7ECD;</h4>
<blockquote>
<p>RabbitMQ is a message broker: it accepts and forwards messages. You can think about it as a post office: when you put the mail that you want posting in a post box, you can be sure that Mr. or Ms. Mailperson will eventually deliver the mail to your recipient. In this analogy, RabbitMQ is a post box, a post office and a postman.  it accepts, stores and forwards <strong>binary blobs of data</strong> &#x2012; <em>messages</em>.</p>
</blockquote>
<p>rabbitmy&#x662F;&#x4E00;&#x4E2A;&#x6D88;&#x606F;&#x4EE3;&#x7406;(&#x96C6;&#x7FA4;&#x4E2D;&#x7684;&#x4E00;&#x53F0;&#x6216;&#x591A;&#x53F0;&#x670D;&#x52A1;&#x5668;&#x7EDF;&#x79F0;broker, &#x53EF;&#x4EE5;&#x8BA4;&#x4E3A;&#x662F;&#x6D88;&#x606F;&#x8F6C;&#x53D1;&#x5668;)&#xFF1A;&#x5B83;&#x63A5;&#x53D7;&#x548C;&#x8F6C;&#x53D1;&#x6D88;&#x606F;&#x3002;&#x4F60;&#x53EF;&#x4EE5;&#x628A;&#x5B83;&#x60F3;&#x8C61;&#x6210;&#x662F;&#x4E00;&#x4E2A;&#x90AE;&#x5C40;&#xFF1A;&#x5F53;&#x4F60;&#x628A;&#x60F3;&#x90AE;&#x5BC4;&#x51FA;&#x53BB;&#x7684;&#x90AE;&#x4EF6;&#x653E;&#x8FDB;&#x90AE;&#x7BB1;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x76F8;&#x4FE1;&#x90AE;&#x5BC4;&#x5458;&#x4F1A;&#x6700;&#x7EC8;&#x628A;&#x90AE;&#x4EF6;&#x4F20;&#x9012;&#x7ED9;&#x4F60;&#x7684;&#x63A5;&#x53D7;&#x8005;&#x3002;&#x5728;&#x8FD9;&#x91CC;&#xFF0C;rabbitmq&#x662F;&#x90AE;&#x7BB1;&#x3001;&#x90AE;&#x5C40;&#x3001;&#x90AE;&#x5BC4;&#x5458;&#x3002;&#x5B83;&#x63A5;&#x53D7;&#x3001;&#x5B58;&#x50A8;&#x3001;&#x8F6C;&#x53D1;&#x6570;&#x636E;&#x7684;&#x4E8C;&#x8FDB;&#x5236;&#x5757;&#xFF0C;&#x5373;&#x6D88;&#x606F;&#x3002;</p>
<blockquote>
<p>A program that sends messages is a <em>producer</em> .</p>
<p><em>A queue</em> is the name for a post box which lives inside RabbitMQ. Although messages flow through RabbitMQ and your applications, they can only be stored inside a <em>queue</em>. A <em>queue</em> is only bound by the host&apos;s memory &amp; disk limits, it&apos;s essentially a large message buffer. Many <em>producers</em> can send messages that go to one queue, and many <em>consumers</em> can try to receive data from one <em>queue</em>. This is how we represent a queue:</p>
<p>A <em>consumer</em> is a program that mostly waits to receive messages:</p>
</blockquote>
<p>&#x53D1;&#x9001;&#x6D88;&#x606F;&#x7684;&#x7A0B;&#x5E8F;&#x53EB;&#x505A;&#x751F;&#x4EA7;&#x8005;</p>
<p>&#x961F;&#x5217;&#x662F;RabbitMQ&#x5185;&#x90E8;&#x7684;&#x90AE;&#x7BB1;&#x7684;&#x540D;&#x79F0;&#x3002;&#x5C3D;&#x7BA1;&#x6D88;&#x606F;&#x6D41;&#x7ECF;RabbitMQ&#x548C;&#x60A8;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#xFF0C;&#x4F46;&#x5B83;&#x4EEC;&#x53EA;&#x80FD;&#x5B58;&#x50A8;&#x5728;&#x961F;&#x5217;&#x4E2D;&#x3002;&#x961F;&#x5217;&#x4EC5;&#x53D7;&#x4E3B;&#x673A;&#x7684;&#x5185;&#x5B58;&#x548C;&#x78C1;&#x76D8;&#x9650;&#x5236;&#x7684;&#x7EA6;&#x675F;&#xFF0C;&#x5B83;&#x5B9E;&#x8D28;&#x4E0A;&#x662F;&#x4E00;&#x4E2A;&#x5927;&#x7684;&#x6D88;&#x606F;&#x7F13;&#x51B2;&#x533A;&#x3002;&#x8BB8;&#x591A;&#x751F;&#x4EA7;&#x8005;&#x53EF;&#x4EE5;&#x53D1;&#x9001;&#x6D88;&#x606F;&#x5230;&#x4E00;&#x4E2A;&#x961F;&#x5217;&#xFF0C;&#x8BB8;&#x591A;&#x6D88;&#x8D39;&#x8005;&#x53EF;&#x4EE5;&#x5C1D;&#x8BD5;&#x4ECE;&#x4E00;&#x4E2A;&#x961F;&#x5217;<strong>&#x63A5;&#x6536;</strong>&#x6570;&#x636E;&#x3002;</p>
<p>&#x7B49;&#x5F85;<strong>&#x63A5;&#x53D7;&#x6D88;&#x606F;</strong>&#x7684;&#x7A0B;&#x5E8F;&#x88AB;&#x53EB;&#x505A;&#x6D88;&#x8D39;&#x8005;</p>
<h2 id="sending">Sending</h2>
<blockquote>
<p>Producer sends messages to the &quot;hello&quot; queue. The consumer receives messages from that queue.</p>
</blockquote>
<p><img src="images/hello_world.png" alt="hello_world"></p>
<p>&#x751F;&#x4EA7;&#x8005;&#x53D1;&#x9001;&#x6D88;&#x606F;&#x5230;&#x201C;hello&#x201D;&#x961F;&#x5217;&#xFF0C;&#x6D88;&#x8D39;&#x8005;&#x4ECE;&#x961F;&#x5217;&#x63A5;&#x53D7;&#x6D88;&#x606F;&#x3002;</p>
<blockquote>
<h4 id="rabbitmq-libraries">RabbitMQ libraries</h4>
<p>RabbitMQ speaks multiple protocols. This tutorial uses AMQP 0-9-1, which is an open, general-purpose protocol for messaging. There are a number of clients for RabbitMQ in <a href="https://www.rabbitmq.com/devtools.html" target="_blank">many different languages</a>. In this tutorial series we&apos;re going to use <a href="https://pika.readthedocs.org/en/stable/" target="_blank">Pika 1.0.0</a>, which is the Python client recommended by the RabbitMQ team. To install it you can use the <a href="https://pip.pypa.io/en/stable/quickstart/" target="_blank">pip</a> package management tool:</p>
<p><code>python -m pip install pika --upgrade</code></p>
</blockquote>
<p>python&#x4E2D;&#x4F7F;&#x7528;pika&#x4F5C;&#x4E3A;&#x5BA2;&#x6237;&#x7AEF;&#x3002;</p>
<p>&#x793A;&#x4F8B;&#xFF1A;</p>
<blockquote>
<p> Our first program <code>send.py</code> will send a single message to the queue. The first thing we need to do is to establish a <strong>connection</strong> with RabbitMQ server.</p>
</blockquote>
<pre><code class="lang-python"><span class="hljs-comment">#!/usr/bin/env python</span>
<span class="hljs-keyword">import</span> pika

connection = pika.BlockingConnection(pika.ConnectionParameters(<span class="hljs-string">&apos;localhost&apos;</span>))
channel = connection.channel()
</code></pre>
<blockquote>
<p>Next, before sending we need to make sure the recipient queue exists. If we send a message to non-existing location, RabbitMQ will just drop the message.</p>
</blockquote>
<p>&#x53D1;&#x9001;&#x4E4B;&#x524D;&#x5FC5;&#x987B;&#x786E;&#x4FDD;&#x63A5;&#x6536;&#x961F;&#x5217;&#x5B58;&#x5728;&#xFF0C;&#x5982;&#x679C;&#x4E0D;&#x5B58;&#x5728;&#xFF0C;&#x5219;&#x4E22;&#x5F03;&#x6D88;&#x606F;&#x3002;</p>
<pre><code class="lang-python">channel.queue_declare(queue=<span class="hljs-string">&apos;hello&apos;</span>)
</code></pre>
<blockquote>
<p>In RabbitMQ a message can never be sent directly to the queue, it always needs to go through an <em>exchange</em>. But let&apos;s not get dragged down by the details &#x2012; you can read more about <em>exchanges</em> in <a href="https://www.rabbitmq.com/tutorials/tutorial-three-python.html" target="_blank">the third part of this tutorial</a>. All we need to know now is how to use a default exchange identified by an empty string. This exchange is special &#x2012; it allows us to specify exactly to which queue the message should go. The queue name needs to be specified in the routing_key parameter:</p>
</blockquote>
<p>&#x5728;rabbitmq&#x4E2D;&#x7EDD;&#x4E0D;&#x80FD;&#x76F4;&#x63A5;&#x5411;&#x4E00;&#x4E2A;&#x961F;&#x5217;&#x53D1;&#x9001;&#x6D88;&#x606F;&#xFF0C;&#x5B83;&#x9700;&#x8981;&#x901A;&#x8FC7;<strong>exchange</strong>&#xFF0C;&#x4F46;&#x662F;&#x6211;&#x4EEC;&#x4E0D;&#x8981;&#x88AB;&#x7EC6;&#x8282;&#x62D6;&#x7D2F;-&#x4F60;&#x53EF;&#x4EE5;&#x9605;&#x8BFB;&#x66F4;&#x591A;&#x5173;&#x4E8E;<em>exchanges</em>&#x7684;&#x4FE1;&#x606F;&#x3002;&#x6211;&#x4EEC;&#x7528;&#x7A7A;&#x5B57;&#x7B26;&#x4E32;&#x6765;&#x5B9A;&#x4E49;&#x9ED8;&#x8BA4;&#x7684;exchange&#x3002;&#x8FD9;&#x4E2A;exchange&#x5F88;&#x7279;&#x6B8A;&#xFF0C;&#x5B83;&#x5141;&#x8BB8;&#x6211;&#x4EEC;&#x7CBE;&#x786E;&#x5730;&#x6307;&#x5B9A;&#x6D88;&#x606F;&#x5E94;&#x8BE5;&#x53BB;&#x54EA;&#x4E2A;&#x961F;&#x5217;&#x3002;&#x961F;&#x5217;&#x7684;&#x540D;&#x5B57;&#x9700;&#x8981;&#x6807;&#x8BC6;&#x5728;<strong>routing_key</strong>&#x4E2D;&#x3002;</p>
<pre><code class="lang-python">channel.basic_publish(exchange=<span class="hljs-string">&apos;&apos;</span>,
                      routing_key=<span class="hljs-string">&apos;hello&apos;</span>,
                      body=<span class="hljs-string">&apos;Hello World!&apos;</span>)
print(<span class="hljs-string">&quot; [x] Sent &apos;Hello World!&apos;&quot;</span>)
</code></pre>
<blockquote>
<p>Before exiting the program we need to make sure the network buffers were flushed and our message was actually delivered to RabbitMQ. We can do it by gently closing the connection.    </p>
</blockquote>
<p>&#x5728;&#x9000;&#x51FA;&#x7A0B;&#x5E8F;&#x4E4B;&#x524D;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x786E;&#x4FDD;&#x7F51;&#x7EDC;&#x7F13;&#x51B2;&#x533A;&#x5DF2;&#x88AB;&#x5237;&#x65B0;, &#x5E76;&#x4E14;&#x6D88;&#x606F;&#x88AB;&#x771F;&#x6B63;&#x7684;&#x4F20;&#x9012;&#x5230;&#x4E86;rabbitmq&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x5173;&#x95ED;&#x8FDE;&#x63A5;&#x6765;&#x5B8C;&#x6210;&#x5B83;&#x3002;</p>
<pre><code class="lang-python">connection.close()
</code></pre>
<blockquote>
<p>Sending doesn&apos;t work!</p>
<p>If this is your first time using RabbitMQ and you don&apos;t see the &quot;Sent&quot; message then you may be left scratching your head wondering what could be wrong. Maybe the broker was started without enough free disk space (by default it needs at least 200 MB free) and is therefore refusing to accept messages. Check the broker logfile to confirm and reduce the limit if necessary. The <a href="https://www.rabbitmq.com/configure.html#config-items" target="_blank">configuration file documentation</a> will show you how to set disk_free_limit.</p>
</blockquote>
<p>&#x6CA1;&#x6709;&#x53D1;&#x9001;&#x6210;&#x529F;&#xFF01;</p>
<p>&#x53EF;&#x80FD;&#x662F;&#x56E0;&#x4E3A;broker&#x542F;&#x52A8;&#x7684;&#x65F6;&#x5019;&#x6CA1;&#x6709;&#x8DB3;&#x591F;&#x7684;&#x786C;&#x76D8;&#x7A7A;&#x95F4;(&#x9ED8;&#x8BA4;&#x9700;&#x8981;200M)&#xFF0C;&#x5B83;&#x4F1A;&#x62D2;&#x7EDD;&#x63A5;&#x53D7;&#x6D88;&#x606F;&#x3002;&#x68C0;&#x67E5;broker&#x7684;logfile&#x6765;&#x786E;&#x8BA4;&#x3002;&#x5728;configuration&#x6587;&#x6863;&#x4E2D;&#x4F1A;&#x5411;&#x4F60;&#x5C55;&#x793A;&#x5982;&#x4F55;&#x8BBE;&#x7F6E;<code>disk_free_limit</code></p>
<h2 id="receiving">Receiving</h2>
<blockquote>
<p>Our second program <code>receive.py</code> will receive messages from the queue and print them on the screen.</p>
<p>Again, first we need to connect to RabbitMQ server. The code responsible for connecting to Rabbit is the same as previously.</p>
<p>The next step, just like before, is to make sure that the queue exists. Creating a queue using queue_declare is idempotent &#x2012; we can run the command as many times as we like, and only one will be created.</p>
</blockquote>
<p><code>receive.py</code>  &#x5C06;&#x4F1A;&#x4ECE;&#x961F;&#x5217;&#x63A5;&#x6536;&#x6D88;&#x606F;&#x5E76;&#x6253;&#x5370;&#x5728;&#x5C4F;&#x5E55;&#x4E0A;&#x3002;</p>
<p>&#x9996;&#x5148;&#x6211;&#x4EEC;&#x5FC5;&#x987B;&#x8FDE;&#x63A5;&#x5230;rabbitmq&#x670D;&#x52A1;&#x5668;&#x4E0A;&#xFF0C;&#x7136;&#x540E;&#x786E;&#x8BA4;&#x961F;&#x5217;&#x662F;&#x5426;&#x5B58;&#x5728;&#x3002;</p>
<p>&#x7528;<code>queue_declare</code>&#x521B;&#x5EFA;&#x961F;&#x5217;&#x662F;<strong>&#x5E42;&#x7B49;</strong>&#x7684;&#xFF0C;&#x6211;&#x4EEC;&#x80FD;&#x8FD0;&#x884C;&#x8FD9;&#x4E2A;&#x547D;&#x4EE4;&#x591A;&#x6B21;&#xFF0C;&#x4F46;&#x662F;&#x53EA;&#x6709;&#x4E00;&#x4E2A;&#x961F;&#x5217;&#x4F1A;&#x88AB;&#x521B;&#x5EFA;&#x3002;</p>
<pre><code class="lang-python">channel.queue_declare(queue=<span class="hljs-string">&apos;hello&apos;</span>)
</code></pre>
<blockquote>
<p>You may ask why we declare the queue again &#x2012; we have already declared it in our previous code. We could avoid that if we were sure that the queue already exists. For example if send.py program was run before. But we&apos;re not yet sure which program to run first. In such cases it&apos;s a good practice to repeat declaring the queue in both programs.</p>
</blockquote>
<p>&#x4F60;&#x53EF;&#x80FD;&#x4F1A;&#x95EE;&#x4E3A;&#x4EC0;&#x4E48;&#x53C8;&#x58F0;&#x660E;&#x4E86;&#x4E00;&#x6B21;&#x961F;&#x5217;&#xFF0C;&#x6211;&#x4EEC;&#x5DF2;&#x7ECF;&#x5728;&#x4E4B;&#x524D;&#x7684;&#x4EE3;&#x7801;&#x4E2D;&#x58F0;&#x660E;&#x8FC7;&#x4E86;&#xFF0C;&#x5982;&#x679C;&#x80FD;&#x786E;&#x4FDD;&#x961F;&#x5217;&#x5DF2;&#x7ECF;&#x5B58;&#x5728;&#xFF0C;&#x5219;&#x53EF;&#x4EE5;&#x4E0D;&#x7528;&#x91CD;&#x590D;&#x58F0;&#x660E;&#xFF0C;&#x6BD4;&#x5982;<code>send.py</code>&#x5728;&#x4E4B;&#x524D;&#x5DF2;&#x7ECF;&#x8FD0;&#x884C;&#x4E86;&#x3002;&#x4F46;&#x662F;&#x4E0D;&#x80FD;&#x786E;&#x5B9A;&#x54EA;&#x4E2A;&#x7A0B;&#x5E8F;&#x5148;&#x8FD0;&#x884C;&#xFF0C;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#x5728;&#x4E24;&#x8FB9;&#x7684;&#x4EE3;&#x7801;&#x4E2D;&#x91CD;&#x590D;&#x58F0;&#x660E;&#x4F1A;&#x662F;&#x4E00;&#x4E2A;&#x597D;&#x7684;&#x4E60;&#x60EF;&#x3002;</p>
<blockquote>
<blockquote>
<h4 id="&#x9898;&#x5916;&#x8BDD;">&#x9898;&#x5916;&#x8BDD;</h4>
</blockquote>
<p>Listing queues</p>
<p>You may wish to see what queues RabbitMQ has and how many messages are in them. You can do it (as a privileged user) using the rabbitmqctl tool:</p>
<p>&#x5217;&#x51FA;&#x6240;&#x6709;&#x7684;&#x961F;&#x5217;&#xFF0C;&#x6709;&#x591A;&#x5C11;&#x6D88;&#x606F;&#x5728;&#x961F;&#x5217;&#x4E2D;&#x3002;</p>
<p>sudo rabbitmqctl list_queues`</p>
<p>Receiving messages from the queue is more complex. It works by subscribing a callback function to a queue. Whenever we receive a message, this callback function is called by the Pika library. In our case this function will print on the screen the contents of the message.</p>
</blockquote>
<p>&#x4ECE;&#x961F;&#x5217;&#x63A5;&#x6536;&#x6D88;&#x606F;&#x66F4;&#x590D;&#x6742;&#x4E00;&#x4E9B;&#x3002;&#x961F;&#x5217;&#x8BA2;&#x9605;&#x4E00;&#x4E2A;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#xFF0C;&#x65E0;&#x8BBA;&#x4F55;&#x65F6;&#x63A5;&#x6536;&#x5230;&#x4E00;&#x4E2A;&#x6D88;&#x606F;&#xFF0C;&#x8FD9;&#x4E2A;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#x90FD;&#x4F1A;&#x88AB;&#x8C03;&#x7528;&#x3002;</p>
<pre><code class="lang-python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">callback</span><span class="hljs-params">(ch, method, properties, body)</span>:</span>
    print(<span class="hljs-string">&quot; [x] Received %r&quot;</span> % body)

channel.basic_consume(queue=<span class="hljs-string">&apos;hello&apos;</span>,
                      auto_ack=<span class="hljs-keyword">True</span>,
                      on_message_callback=callback)
</code></pre>
<blockquote>
<p>For that command to succeed we must be sure that a queue which we want to subscribe to exists. Fortunately we&apos;re confident about that &#x2012; we&apos;ve created a queue above &#x2012; using <code>queue_declare</code>.</p>
<p>And finally, we enter a never-ending loop that waits for data and runs callbacks whenever necessary.</p>
</blockquote>
<p>&#x4E3A;&#x4E86;&#x8BA9;<code>basic_consume</code>&#x80FD;&#x987A;&#x5229;&#x6267;&#x884C;&#xFF0C;&#x6211;&#x4EEC;&#x5FC5;&#x987B;&#x786E;&#x4FDD;&#x961F;&#x5217;&#x5B58;&#x5728;&#x3002;&#x5E78;&#x8FD0;&#x7684;&#x662F;&#x6211;&#x4EEC;&#x7528;<code>queue_declare</code>&#x521B;&#x5EFA;&#x4E86;&#x3002;</p>
<p>&#x6700;&#x540E;&#xFF0C;&#x542F;&#x52A8;&#x4E86;&#x4E00;&#x4E2A;&#x4ECE;&#x4E0D;&#x505C;&#x6B62;&#x7684;&#x5FAA;&#x73AF;&#xFF0C;&#x7B49;&#x5F85;&#x6D88;&#x606F;&#x5E76;&#x5728;&#x5FC5;&#x8981;&#x65F6;&#x8FD0;&#x884C;&#x56DE;&#x8C03;&#x3002;</p>
<pre><code class="lang-python">print(<span class="hljs-string">&apos; [*] Waiting for messages. To exit press CTRL+C&apos;</span>)
channel.start_consuming()
</code></pre>
<h4 id="&#x5B8C;&#x6574;&#x7684;&#x7A0B;&#x5E8F;">&#x5B8C;&#x6574;&#x7684;&#x7A0B;&#x5E8F;</h4>
<p><code>send.py</code></p>
<pre><code class="lang-python"><span class="hljs-comment">#!/usr/bin/env python</span>
<span class="hljs-keyword">import</span> pika

connection = pika.BlockingConnection(
    pika.ConnectionParameters(host=<span class="hljs-string">&apos;localhost&apos;</span>))
channel = connection.channel()

channel.queue_declare(queue=<span class="hljs-string">&apos;hello&apos;</span>)

channel.basic_publish(exchange=<span class="hljs-string">&apos;&apos;</span>, routing_key=<span class="hljs-string">&apos;hello&apos;</span>, body=<span class="hljs-string">&apos;Hello World!&apos;</span>)
print(<span class="hljs-string">&quot; [x] Sent &apos;Hello World!&apos;&quot;</span>)
connection.close()
</code></pre>
<p><code>receive.py</code></p>
<pre><code class="lang-python"><span class="hljs-comment">#!/usr/bin/env python</span>
<span class="hljs-keyword">import</span> pika

connection = pika.BlockingConnection(
    pika.ConnectionParameters(host=<span class="hljs-string">&apos;localhost&apos;</span>))
channel = connection.channel()

channel.queue_declare(queue=<span class="hljs-string">&apos;hello&apos;</span>)

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">callback</span><span class="hljs-params">(ch, method, properties, body)</span>:</span>
    print(<span class="hljs-string">&quot; [x] Received %r&quot;</span> % body)

channel.basic_consume(
    queue=<span class="hljs-string">&apos;hello&apos;</span>, on_message_callback=callback, auto_ack=<span class="hljs-keyword">True</span>)

print(<span class="hljs-string">&apos; [*] Waiting for messages. To exit press CTRL+C&apos;</span>)
channel.start_consuming()
</code></pre>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                
                <a href="worker.html" class="navigation navigation-next navigation-unique" aria-label="Next page: Work queues">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Hello World","level":"1.2.1","depth":2,"next":{"title":"Work queues","level":"1.2.2","depth":2,"path":"queue/worker.md","ref":"queue/worker.md","articles":[]},"previous":{"title":"消息队列模式","level":"1.2","depth":1,"ref":"","articles":[{"title":"Hello World","level":"1.2.1","depth":2,"path":"queue/hello_world.md","ref":"queue/hello_world.md","articles":[]},{"title":"Work queues","level":"1.2.2","depth":2,"path":"queue/worker.md","ref":"queue/worker.md","articles":[]},{"title":"Publish / Subscribe ","level":"1.2.3","depth":2,"path":"queue/publish_subscribe.md","ref":"queue/publish_subscribe.md","articles":[]},{"title":"Routing","level":"1.2.4","depth":2,"path":"queue/routing.md","ref":"queue/routing.md","articles":[]},{"title":"Topics","level":"1.2.5","depth":2,"path":"queue/topics.md","ref":"queue/topics.md","articles":[]},{"title":"RPC","level":"1.2.6","depth":2,"path":"queue/rpc.md","ref":"queue/rpc.md","articles":[]},{"title":"Publisher Confirms","level":"1.2.7","depth":2,"path":"queue/publisher_confirms.md","ref":"queue/publisher_confirms.md","articles":[]}]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":["livereload"],"pluginsConfig":{"livereload":{},"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"queue/hello_world.md","mtime":"2020-04-21T12:37:27.751Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2020-04-21T12:33:21.744Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-livereload/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

